{% extends 'base.html' %} {% block content %}
<h1>Data Analytics</h1>

<div class="row">
    <div class="col s12 l6">
        <div class="col s12 chart_border">
            <h4 class="chart_title">Meal Type</h4>
            <div id="meal_type_pie"></div>
        </div>
    </div>
    <div class="col s12 l6">
        <div class="col s12 chart_border">
            <h4 class="chart_title">Cooking Time</h4>
            <div id="time_pie"></div>
        </div>
    </div>
    <div class="col s12 l6 offset-l3">
        <div class="col s12 chart_border">
            <h4 class="chart_title">Country of Origin</h4>
            <div id="country_pie" class="pie_chart"></div>
        </div>
    </div>
</div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
<script>
    queue()
        .defer(d3.json, "/cook_book/recipes")
        .await(makeGraphs);

    function makeGraphs(error, recipesJson) {
        var ndx = crossfilter(recipesJson);

        var meal_type_dim = ndx.dimension(dc.pluck('meal_type'));
        var total_number_of_meal_type = meal_type_dim.group().reduceCount();

        dc.pieChart('#meal_type_pie')
            .height(400)
            .radius(300)
            .transitionDuration(1500)
            .dimension(meal_type_dim)
            .group(total_number_of_meal_type);

        var total_time_dim = ndx.dimension(function(d) {
            if (d.total_time < 31)
                return '30 mins or less';
            else if (d.total_time > 30 && d.total_time < 60)
                return '30 to 60 mins';
            else
                return 'more than 60 mins';
        });

        var total_number_of_that_time = total_time_dim.group().reduceCount();

        dc.pieChart('#time_pie')
            .height(400)
            .radius(300)
            .transitionDuration(1500)
            .dimension(total_time_dim)
            .group(total_number_of_that_time);
            
        var country_dim = ndx.dimension(dc.pluck('country'));
        var total_number_of_country = country_dim.group().reduceCount();

        dc.pieChart('#country_pie')
            .height(400)
            .radius(300)
            .transitionDuration(1500)
            .dimension(country_dim)
            .group(total_number_of_country);

        dc.renderAll();
        
        

    }
</script>
{% endblock %}
