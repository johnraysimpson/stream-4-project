<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!--<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" type="text/css" />-->
    <style>
        .bad-input {
            border-style: solid;
            border-width: 3px;
            border-color: red;
            color: red;
            display: inline-block;
        }

        .close_field {
            color: red;
            font-size: 3rem;
        }

        .input-space {
            max-width: 80%;
        }

        th>p {
            font-style: italic;
        }

        .recipe_box>div {
            border: 3px solid grey;
            border-radius: 30px;
            margin: 5px 0;
        }

        .recipe_box>div>div>img {
            margin-top: 5px;
        }

        .recipe_box>div>a {
            text-align: center;
        }

        .icon-size {
            font-size: 3rem;
        }

        .ingredients_input>div>input[type=text] {
            margin-top: 30px;
        }

        .ingredients_input {
            margin-bottom: 0;
        }

        .submit_box {
            border-radius: 10px;
            background-color: #f8f8f8;
            padding: 0px 10px 5px 10px;
        }

        .submit_box>div>button {
            margin-left: 10px;
        }

        table.striped>tbody>tr:nth-child(odd) {
            background-color: #f8f8f8;
        }
        
        table.striped>tbody>tr:nth-child(even) {
            background-color: #ffffff;
        }

        .add_recipe_btn {
            margin: 10px 0px 0px 20px;
        }
        
        .recipe_name {
            font-size: 24px;
            margin: 8px 0;
        }
    </style>
</head>

<body>
    {% if user %}
    <header>
        <ul id="dropdown1" class="dropdown-content">
            <li class="divider"></li>
            <li><a href="{{ url_for('get_user_recipes', user_id=user._id) }}">My Recipes</a></li>
            <li class="divider"></li>
            <li><a href="#!">My Favourites</a></li>
            <li class="divider"></li>
            <li><a href="#!">Account Details</a></li>
        </ul>
        <nav>
            <div class="nav-wrapper">
                <a href="{{ url_for('user_home', user_id=user._id) }}" class="brand-logo">Easy RecipEasy</a>
                <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
                <ul class="right hide-on-med-and-down">
                    <li><a class="dropdown-trigger" href="#!" data-target="dropdown1">Hi, {{ user.first.capitalize() }}<i class="material-icons right">arrow_drop_down</i></a></li>
                    <li><a href="{{ url_for('add_recipe', user_id=user._id) }}">Add Recipe</a></li>
                </ul>
            </div>
        </nav>

        <ul class="sidenav" id="mobile-demo">
            <li class="mobile_greeting">
                <h5>Hi, {{ user.first.capitalize() }}</h5>
            </li>
            <li><a href="{{ url_for('add_recipe', user_id=user._id) }}">Add Recipe</a></li>
            <li><a href="{{ url_for('get_user_recipes', user_id=user._id) }}">My Recipes</a></li>
            <li><a href="#!">My Favourites</a></li>
            <li><a href="#!">Account Details</a></li>
        </ul>
    </header>
    {% else %}
    <header>
        <nav>
            <div class="nav-wrapper">
                <a href="{{ url_for('home') }}" class="brand-logo">Easy RecipEasy</a>
                <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
                <ul class="right hide-on-med-and-down">
                    <li><a href="{{ url_for('sign_in') }}">Sign In</a></li>
                    <li><a href="{{url_for('sign_up')}}">Sign Up</a></li>
                </ul>
            </div>
        </nav>

        <ul class="sidenav" id="mobile-demo">
            <li><a href="#">Your Recipes</a></li>
            <li><a href="#">Add Recipe</a></li>
        </ul>
    </header>
    {% endif %}
    <div class="container">
        {% block content %} {% endblock %}
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $(".dropdown-trigger").dropdown();
            $('input#meal_desc').characterCounter();
            $('.sidenav').sidenav();
            $('select').formSelect();
            $(document).ready(function() {
                $('.collapsible').collapsible();
            });
            $('select[required]').css({
                display: 'inline',
                position: 'absolute',
                float: 'left',
                padding: 0,
                margin: 0,
                border: '1px solid rgba(255,255,255,0)',
                height: 0,
                width: 0,
                top: '2em',
                left: '3em'
            });
            M.updateTextFields();
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://pastebin.com/raw/k79mKHzG");
            xhr.send();

            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var countryData = {};
                    var data = JSON.parse(this.responseText);
                    for (var i in data) {
                        countryData[data[i].country_name] = null;
                    }
                    //console.log(countryData)
                    $('input.autocomplete').autocomplete({
                        data: countryData,
                        limit: 5,
                    });
                }
            };
            var max_ingredients = 20; //maximum input boxes allowed
            var wrapper_ingredient = $(".input_ingredients_wrap"); //Fields wrapper
            var add_ingredient_button = $(".add_ingredient_button"); //Add button ID

            var x = 3; //initlal text box count
            $(add_ingredient_button).click(function(e) { //on add input button click
                e.preventDefault();
                if (x < max_ingredients) { //max input box allowed
                    x++; //text box increment
                    $(wrapper_ingredient).append(`<tr>
                                            <td class="col s2"><input type="text" id="amount[${x}]" name="amount[${x}]" required class="validate"></td>
                                            <td class="col s4"><input type="text" id="ingredient[${x}]" name="ingredient[${x}]" required class="vaildate"></td>
                                            <td class="col s5"><input type="text" id="prep[${x}]" name="prep[${x}]" class="validate"></td>
                                            <td class="col s1"><a href="#" class="remove_field"><i class="close_field material-icons right">close</i></a></td>
                                        </tr>`); //add input box
                }
            });

            $(wrapper_ingredient).on("click", ".remove_field", function(e) { //user click on remove text
                e.preventDefault();
                $(this).parent('td').parent('tr').remove();
                x--;
            })
            var max_methods = 10; //maximum input boxes allowed
            var wrapper_method = $(".input_methods_wrap"); //Fields wrapper
            var add_method_button = $(".add_method_button"); //Add button ID

            var y = 1; //initlal text box count
            $(add_method_button).click(function(e) { //on add input button click
                e.preventDefault();
                if (y < max_methods) { //max input box allowed
                    y++; //text box increment
                    $(wrapper_method).append(`<div class="input-field col s12">
                                            <h5>Step ${y}</h5>
                                            <textarea name="method[${y}]" id="method[${y}]" required class="materialize-textarea col s11"></textarea>
                                            <a href="#" class="remove_field col s1"><i class="close_field material-icons right">close</i></a>
                                        </div>`); //add input box
                }
            });

            $(wrapper_method).on("click", ".remove_field", function(e) { //user click on remove text
                e.preventDefault();
                $(this).parent('div').remove();
                y--;
            });
        });
    </script>
</body>

</html>
